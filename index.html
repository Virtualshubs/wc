class D3TwinsViewer extends HTMLElement {
  constructor() {
    super();

    // Shadow DOM cerrado — imposible inspeccionarlo
    const shadow = this.attachShadow({ mode: "closed" });

    this.iframe = document.createElement("iframe");
    this.iframe.setAttribute("frameborder", "0");
    this.iframe.style = "width:100%;height:100%;border:0;";

    shadow.appendChild(this.iframe);
  }

  connectedCallback() {
    const viewerSrc = this.getAttribute("src");
    if (!viewerSrc) {
      console.error("No se proporcionó src al <d3-twins-viewer>");
      return;
    }

    // Sustituir viewer → load de forma automática
    const finalURL = viewerSrc.replace(
      /^https?:\/\/viewer\.3dtwins\.tech/,
      "https://load.3dtwins.tech"
    );

    // Cargar el visor directamente dentro del iframe (sin srcdoc)
    this.iframe.src = finalURL;
  }
}

customElements.define("d3-twins-viewer", D3TwinsViewer);
