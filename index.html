class D3TwinsViewer extends HTMLElement {
  constructor() {
    super();
    const shadow = this.attachShadow({ mode: "closed" });

    this.iframe = document.createElement("iframe");
    this.iframe.setAttribute("frameborder", "0");
    this.iframe.style = "width:100%;height:100%;border:0;";

    shadow.appendChild(this.iframe);
  }

  connectedCallback() {
    const viewerSrc = this.getAttribute("src"); // URL que apunta a viewer.3dtwins.tech
    if (!viewerSrc) {
      console.error("No se proporcionó src al 3d-twins-viewer");
      return;
    }
    const viewerSrc = this.getAttribute("src");
    if (!viewerSrc) return;

    // Crear HTML mínimo para inyectar en el iframe usando srcdoc
    // Esto fuerza que el visor vea la URL como load.3dtwins.tech
    const iframeHTML = `
      <!DOCTYPE html>
      <html>
        <head>
          <meta charset="UTF-8">
          <title>3D Twins Viewer</title>
        </head>
        <body style="margin:0;">
          <script>
            // Tomar la query string del viewer y reconstruir la URL real
            const viewerURL = "${viewerSrc}";
            const realURL = viewerURL.replace(/^https?:\\/\\/viewer\\.3dtwins\\.tech/, "https://load.3dtwins.tech");
            // Redirigir la ventana dentro del iframe al dominio real
            window.location.href = realURL;
          </script>
        </body>
      </html>
    `;
    // Cargar directamente el visor desde load.3dtwins.tech
    const realURL = viewerSrc.replace("viewer.", "load.");

    this.iframe.srcdoc = iframeHTML;
    this.iframe.src = load.3dtwins.tech/index.html; // <-- USAR src REAL
  }
}
